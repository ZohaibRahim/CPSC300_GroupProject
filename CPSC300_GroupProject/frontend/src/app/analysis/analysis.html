<div class="analysis-container">
  <div class="header">
    <h3>Resume Analysis</h3>
    <p>Compare your resume against any job description using our AI engine.</p>
  </div>

  <form [formGroup]="analysisForm" (ngSubmit)="onAnalyze()" class="analysis-form">
    
    <div class="form-row">
      <div class="form-field">
        <label for="jd">Job Description</label>
        <textarea id="jd" formControlName="jobDescription" placeholder="Paste the job description here..." rows="10"></textarea>
      </div>

      <div class="form-field">
        <label for="resume">Your Resume</label>
        <textarea id="resume" formControlName="resumeText" placeholder="Paste your resume text here..." rows="10"></textarea>
      </div>
    </div>

    <div class="controls">
      <div class="toggle-wrapper">
        <label class="switch">
          <input type="checkbox" formControlName="useAi">
          <span class="slider round"></span>
        </label>
        <span class="toggle-label">Enable Gemini AI Insights</span>
      </div>

      <button type="submit" class="analyze-btn" [disabled]="isLoading || analysisForm.invalid">
        <span *ngIf="!isLoading">Analyze Match</span>
        <span *ngIf="isLoading">Analyzing...</span>
      </button>
    </div>

    <div *ngIf="errorMessage" class="error-banner">
      {{ errorMessage }}
    </div>

  </form>

  <div *ngIf="result" class="results-section">
    <h4 class="results-title">Analysis Results</h4>

    <div class="stats-grid">
      <div class="stat-card match-score">
        <span class="label">Match Score</span>
        <span class="value">{{ result.match_score }}%</span>
        <div class="progress-bar">
          <div class="fill" [style.width.%]="result.match_score"></div>
        </div>
      </div>

      <div class="stat-card">
        <span class="label">Keyword Density</span>
        <span class="value">{{ result.keyword_density | number:'1.0-2' }}%</span>
      </div>

      <div class="stat-card">
        <span class="label">Experience Match</span>
        <span class="value">{{ result.experience_match }} Years</span>
      </div>
    </div>

    <div class="content-card">
      <h5>Summary</h5>
      <p>{{ result.summary }}</p>
    </div>

    <div class="skills-grid">
      <div class="content-card success">
        <h5>✅ Matched Skills</h5>
        <div class="tags">
          <span *ngFor="let skill of result.matched_skills" class="tag match">{{ skill }}</span>
          <span *ngIf="result.matched_skills.length === 0" class="empty-text">No direct matches found.</span>
        </div>
      </div>

      <div class="content-card warning">
        <h5>⚠️ Missing Keywords</h5>
        <div class="tags">
          <span *ngFor="let skill of result.missing_skills" class="tag missing">{{ skill }}</span>
          <span *ngIf="result.missing_skills.length === 0" class="empty-text">Great job! No missing keywords.</span>
        </div>
      </div>
    </div>

    <div class="content-card ai-box" *ngIf="result.ai_suggestions">
      <div class="ai-header">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l2.846-.813a1.151 1.151 0 0 0 .441-.27l8.69-8.689a1.151 1.151 0 0 0 0-1.628L18.39 5.807a1.151 1.151 0 0 0-1.628 0l-8.69 8.69a1.151 1.151 0 0 0-.27.441ZM12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" />
        </svg>
        <h5>Gemini AI Suggestions</h5>
      </div>
      <p>{{ result.ai_suggestions }}</p>
    </div>

  </div>
</div>